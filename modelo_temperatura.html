<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Widget de Predicci√≥n Remota</title>
    <!-- Carga de Tailwind CSS para estilos modernos y responsivos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Configuraciones de fuente y fondo general */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo gris claro */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        /* Estilos base para inputs */
        input[type="number"] {
            transition: all 0.3s ease;
        }
        input[type="number"]:focus {
            border-color: #3b82f6; /* Azul de Tailwind 500 */
            box-shadow: 0 0 0 1px #3b82f6;
        }
    </style>
</head>
<body>
    <!-- Contenedor principal del widget -->
    <div id="prediction-widget" class="max-w-md w-full p-6 bg-white shadow-2xl rounded-xl space-y-6">
        
        <h1 class="text-2xl font-extrabold text-gray-800 border-b pb-2 mb-4">
            Predicci√≥n Geo-ML <span class="text-sm font-normal text-green-600">(Render API)</span>
        </h1>
        <p class="text-sm text-gray-500">Introduce las coordenadas para obtener un resultado del modelo alojado en Render.</p>
        
        <!-- Controles de entrada -->
        <div class="space-y-4">
            <div>
                <label for="latitude" class="block text-sm font-medium text-gray-700 mb-1">Latitud (ej: 40.7128):</label>
                <input 
                    type="number" 
                    id="latitude" 
                    value="40.7128" 
                    step="any" 
                    class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none"
                >
            </div>
            <div>
                <label for="longitude" class="block text-sm font-medium text-gray-700 mb-1">Longitud (ej: -74.0060):</label>
                <input 
                    type="number" 
                    id="longitude" 
                    value="-74.0060" 
                    step="any" 
                    class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none"
                >
            </div>
        </div>
        
        <button 
            id="predict-button"
            onclick="getPrediction()" 
            class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded-lg shadow-md transition duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50"
        >
            Obtener Predicci√≥n
        </button>
        
        <!-- √Årea de resultados con estilo din√°mico -->
        <div id="resultado" class="text-center p-4 bg-gray-100 border border-gray-200 rounded-lg text-gray-700">
            Esperando datos...
        </div>

    </div>

    <script>
        // Mantiene la referencia al bot√≥n para deshabilitarlo durante la carga
        const predictButton = document.getElementById('predict-button');
        
        async function getPrediction() {
            const latInput = document.getElementById('latitude');
            const lonInput = document.getElementById('longitude');
            const resultadoDiv = document.getElementById('resultado');
            
            // Deshabilitar bot√≥n para prevenir doble clic
            predictButton.disabled = true;
            predictButton.textContent = 'Procesando...';

            const lat = parseFloat(latInput.value);
            const lon = parseFloat(lonInput.value);

            if (isNaN(lat) || isNaN(lon)) {
                resultadoDiv.className = "text-center p-4 rounded-lg bg-red-100 border border-red-300 text-red-700";
                resultadoDiv.textContent = '‚ùå Error: Por favor, ingresa n√∫meros v√°lidos.';
                predictButton.disabled = false;
                predictButton.textContent = 'Obtener Predicci√≥n';
                return;
            }

            resultadoDiv.className = "text-center p-4 rounded-lg bg-yellow-100 border border-yellow-300 text-yellow-700 animate-pulse";
            resultadoDiv.textContent = '‚è±Ô∏è Enviando solicitud al servidor Render...';

            // ESTA ES LA URL P√öBLICA DE TU BACKEND EN RENDER
            const API_BASE_URL = 'https://modelos-flask-backend.onrender.com';
            const url = API_BASE_URL + '/predict'; 

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        latitude: lat,
                        longitude: lon
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // √âxito
                    resultadoDiv.className = "text-center p-4 rounded-lg bg-green-100 border border-green-300 text-green-700 font-bold";
                    resultadoDiv.textContent = `‚úÖ Predicci√≥n Exitosa: ${data.prediction.toFixed(4)}`; 
                } else {
                    // Error del servidor (ej: 500)
                    resultadoDiv.className = "text-center p-4 rounded-lg bg-red-100 border border-red-300 text-red-700";
                    resultadoDiv.textContent = `‚ùå Error del Servidor (${response.status}): ${data.error || 'Desconocido'}`;
                }

            } catch (error) {
                // Error de red (Failed to fetch)
                resultadoDiv.className = "text-center p-4 rounded-lg bg-red-200 border border-red-400 text-red-800";
                resultadoDiv.textContent = `üö® Error de Conexi√≥n (Red): Verifica el backend. Detalles: ${error.message}`;
                console.error('Error al conectar con Render:', error);
            } finally {
                // Habilitar el bot√≥n al finalizar
                predictButton.disabled = false;
                predictButton.textContent = 'Obtener Predicci√≥n';
            }
        }
    </script>
</body>
</html>
